[TOC]

### 理解bro脚本
Bro包含事件驱动的脚本语言，为组织扩展和定制Bro的功能提供了主要手段。事实上，Bro生成的所有输出实际上都是由Bro脚本生成的。将Bro视为实体幕后处理连接和生成事件几乎更容易，而Bro的脚本语言是我们仅有的凡人可以实现与之沟通的媒介。 Bro脚本有效地通知Bro应该存在我们定义的类型事件，然后让我们获得关于连接的信息，以便我们可以基于这些信息执行一些功能。例如，ssl.log文件由Bro脚本生成，该脚本遍历整个证书链，并在证书链中的任何步骤无效时发出通知。通过告诉Bro，如果看到服务器或客户端发出SSL HELLO消息，我们希望了解有关该连接的信息，从而完成整个过程。

通过查看完整的脚本并将其分解为可识别的组件，通常最容易理解Bro的脚本语言。在这个例子中，我们将看看Bro如何根据Team Cymru恶意软件散列注册表检查从网络流量中提取的各种文件的SHA1散列值。团队Cymru恶意软件哈希注册表的一部分包括在具有<MALWARE_HASH> .malware.hash.cymru.com格式的域上执行主机查找的能力，其中<MALWARE_HASH>是文件的SHA1哈希。 Cymru团队还通过“首次看到”时间戳和数字“检测率”填充他们的DNS响应的TXT记录。需要理解的重要方面是Bro已经通过Files框架为文件生成哈希，但它是脚本detect-MHR.bro，负责生成相应的DNS查找，解析响应以及在适当的情况下生成通知。
