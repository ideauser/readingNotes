[TOC]

### 练习
现在我们已经掌握了Bro脚本语言的所有基本概念。 要完成您的Bro语言旅程的第一部分，请完成以下练习。

考虑以下列出的子网作为给定的本地子网：
192.168.1.0/24, 192.68.2.0/24, 172.16.0.0/20, 172.16.16.0/20, 172.16.32.0/20, 172.16.48.0/20.
写一个脚本：

* 找出前10个新连接源IP和端口，目标IP和端口，连接ID，连接开始的时间。
* 统计所有看到的连接并最终打印出来。
* 打印出每个唯一的IP地址，如果它是本地或外部的。

要解决此练习，请加载流量示例exercise_traffic.pcap。
** 注意，下面的示例均使用了[exercise_traffice.pcap](pcapFiles/exercise-traffic.pcap)文件，运行使用
```
script.bro -C -r exercise_traffice.pcap
```

#### 显示所有网络连接 
```
event bro_init()
	{
	print "use all the Bro types";
  
	}
event new_connection(c: connection)
   {
   print fmt("New Connection => orig: %s %s resp: %s %s", c$id$orig_h, c$id$orig_p, c$id$resp_h, c$id$resp_p); 
   } 

event bro_done()
	{
	print "and tell me what you learned";
	}
```
pcap部分连接的完整字段
![](./images/conn.png)

脚本运行结果
```
use all the Bro types
New Connection =>uid:CYZ1U2YlweviwBpsi orig: 192.168.1.1 626/udp resp: 224.0.0.1 626/udp
New Connection =>uid:CRoySYoAdQe1vbov2 orig: 192.168.1.102 68/udp resp: 192.168.1.1 67/udp
New Connection =>uid:Cz2gk812zghIV4m13i orig: 192.168.1.103 138/udp resp: 192.168.1.255 138/udp
New Connection =>uid:CC86it3vQ7FNZcuVcf orig: 192.168.1.103 137/udp resp: 192.168.1.255 137/udp
New Connection =>uid:CjdU7V3q81spa4Iw8b orig: 192.168.1.102 137/udp resp: 192.168.1.255 137/udp
New Connection =>uid:CE2OLg3qNY7iXHBpSd orig: 192.168.1.102 138/udp resp: 192.168.1.255 138/udp
New Connection =>uid:CmDpkBDD6VN5TSHM3 orig: 192.168.1.104 138/udp resp: 192.168.1.255 138/udp
[...]
```